# go-cloud-camp

### GoCloudCamp test assignment

Сервер и клиентская библиотека для динамического управления конфигурацией приложений.

Сервер реализован на языке GoLang и использует в качестве хранилища базу данных MongoDB. Конфигурации хранятся в формате JSON. Поддерживается версионирование (сквозная нумерация) для каждого сервиса. Доступ к серверу осуществляется через REST API или с использованием функций клиентской библиотеки.

## Доступ через REST API

Примеры запросов представлены в файле **requests.http**

### Запрос GET (получить конфигурацию)

Получить последнюю версию конфига

```
GET http://host:port/config?service=name
```

Получить определенный номер версии конфига

```
GET http://host:port/config?service=name&version=number
```

Варианты кодов ответа сервера:

- 200 –Ок. Запрос выполнен успешно

В теле ответа будет содержаться JSON в формате

```json
{
	"key1": "value1",
	"key2": "value2"
}
```

- 400 – Ошибка. Неправильный формат запроса
- 404 – Ошибка. Конфигурация не найдена
- 500 – Внутренняя ошибка сервера

### Запрос POST (создать конфигурацию)

```
POST http://host:port/config
```

В теле запроса передается конфигурация в формате JSON

Варианты ответа сервера:

- 200 – Ок. Запрос выполнен успешно
- 400 – Ошибка. Неправильный формат запроса
- 403 – Ошибка. Конфигурация уже существует
- 500 – Внутренняя ошибка сервера

### Запрос PUT (обновить конфигурацию)

```
PUT http://host:port/config
```

В теле запроса передается конфигурация в формате JSON

Варианты ответа сервера:

- 200 – Ок. Запрос выполнен успешно
- 400 – Ошибка. Неправильный формат запроса
- 404 – Ошибка. Конфигурация не найдена
- 500 – Внутренняя ошибка сервера

### Запрос DELETE (удалить конфигурацию)

Удалить все конфигурации для сервиса

```
GET http://host:port/config?service=name
```

Удалить конфигурацию определенной версии

```
GET http://host:port/config?service=name&version=number
```

Варианты ответа сервера:

- 200 – Ок. Запрос выполнен успешно
- 400 – Ошибка. Неправильный формат запроса
- 403 – Ошибка. Невозможно удалить конфигурацию
- 404 – Ошибка. Конфигурация не найдена
- 500 – Внутренняя ошибка сервера

## Клиентская библиотека

Клиентская библиотека для языка GoLang реализует основные функции работы с конфигурацией:

```go
func CreateConfig(ctx context.Context, data interface{}) error

func ReadAndDecodeConfig(ctx context.Context, cfg interface{}) error

func ReadConfigBytes(ctx context.Context) ([]byte, error)

func UpdateConfig(ctx context.Context, data interface{}) error

func DeleteConfig(ctx context.Context) error
```

Дополнительно в библиотеке реализована функция автоматического обновления конфигурации:

```go
func AssignRefreshCallback(period time.Duration, callback func([]byte)) error
```

В отдельной горутине, через заданные промежутки времени запрашивается конфигурация с сервера. Если она не совпадает с текущей, вызывается функция _callback_ для обработки новой конфигурации.

Пример использования клиентской библиотеки представлен в каталоге example

### Дополнительные библиотеки, использованные в проекте:

- [github.com/ilyakaznacheev/cleanenv](github.com/ilyakaznacheev/cleanenv)
- [github.com/julienschmidt/httprouter](github.com/julienschmidt/httprouter)
- [go.mongodb.org/mongo-driver](go.mongodb.org/mongo-driver)
- [go.uber.org/zap](go.uber.org/zap)
